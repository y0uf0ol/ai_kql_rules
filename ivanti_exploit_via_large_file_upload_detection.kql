// Ivanti Exploit via Large File Upload Detection
// Note: This is an AI Generated Rule use with caution
// https://unit42.paloaltonetworks.com/threat-brief-ivanti-cve-2023-46805-cve-2024-21887/
// MITRE Tactic and Technique: Initial Access, T1190 - Exploit Public-Facing Application
DeviceFileEvents
| where InitiatingProcessFileName has "w3wp.exe" or InitiatingProcessFileName has "IIS"
| where FileName has ".zip" or FileName has ".rar"
| where FileSize > 10000000 // Adjust based on your environment's baseline
| summarize LargeFileUploads=count(), AffectedDevices=dcount(DeviceId) by FileName, FileSize, DeviceId
| where LargeFileUploads > 0