// Detection of Rundll32 Activity Tied to Malware Execution
// AI Generated Rule for identifying suspicious rundll32.exe activity
// Focus on common command line patterns used in attacks

DeviceProcessEvents
| where FileName == "rundll32.exe"
| where ProcessCommandLine has "url.dll,FileProtocolHandler" or ProcessCommandLine has_all("rundll32", ".dll")
| summarize Count= count(), UniqueMachines=dcount(DeviceId) by ProcessCommandLine, DeviceId
| where Count > 3 // Threshold indicative of unusual activity, adjust based on observations